language: python
sudo: false
python:
- '2.7'
- '3.4'
- '3.5'
- '3.6'
- 'pypy-5.3.1'
- 'pypy3.5-5.8.0'
matrix:
  allow_failures:
    - os: osx
# blocklist branches
branches:
  except:
  - requires-io-master
install:
  - pip install "setuptools>=21"
  - pip install "pip>=9"
  - pip install -r requirements-test.txt
  - pip install .[tests] coveralls wheel
script:
  - pytest -vvv --capture=no --showlocals --cov mirakuru tests/
  - pylama
  - rst-lint *.rst
after_success:
  - coveralls
jobs:
  include:
    - stage: osx
      python: '3.6'
      os: osx
deploy:
  provider: pypi
  user: fizyk
  password:
    secure: IBVXG0zLKsBkzdeoC33Lxir01jbvDHdjQ81CPC8PbDPCmUozXgf9eqRFV5VOIYQOboTBzQYRq7RB8efeNKSH3nKf73iahwIYf4ezIxRzUaMzoY4GkyrC/0fQhMk1lAjexrRM1f2o7TIAALPUDyB/EaRcPCBEghxscQEeTlAw08c=
  on:
    tags: true
    all_branches: true
    repo: ClearcodeHQ/mirakuru
    python: 3.6
  distributions: sdist bdist_wheel
